# 🚲 SITP - BikeWatch : 共享单车监控系统

> 基于YOLO的实时单车区域监控与事件检测系统

## 🎯 功能特点

- **实时检测** 🔍 - 使用YOLO模型实时检测视频流中的单车
- **区域监控** 🗺️ - 定义停车区(🟢)和通行区(🔴)多边形ROI
- **事件触发** ⚡ - 检测**阻塞事件**和**违规停放事件**
- **智能记录** 📝 - 自动保存事件截图和日志数据
- **性能优化** ⚡ - 支持CUDA加速，动态帧率控制

## 🛠️ 工作原理

### 检测流程:

视频输入 → YOLO检测 → ROI区域判断 → 事件逻辑处理 → 日志记录

### 核心逻辑
- **停车区检测** 🅿️ - 车辆是否在指定停车区域内
- **通行区检测** 🚦 - 车辆是否阻塞通行区域  
- **时间阈值** ⏱️ - 持续超过设定时间才触发事件
- **IoU计算** 📐 - 使用多边形交集判断车辆位置

## 📁 文件结构
```
├── run(main).py # 主程序
├── config.json # 配置文件
├── weights/ # 模型权重
├── config_files/ # Ultralytics参数配置
├── snaps/ # 事件截图
└── logs.csv # 运行日志
```
## 🚀 运行方式

- 主程序：
```bash
python run(main).py
```
- ROI选择：
```bash
python roi_picker.py --capture                # 捕获frame.jpg
python roi_picker.py --mark <picture-path>    # 鼠标绘制多边形形式ROI
```
### 另附：config.json 参数详解

| 参数类别 | 参数名 | 类型 | 默认值 | 说明 |
|---------|--------|------|--------|------|
| **📷 视频输入** | `capwidth` | 整数 | 768 | 视频采集宽度（推荐32的倍数） |
|  | `capheight` | 整数 | 576 | 视频采集高度（推荐32的倍数） |
|  | `capfps` | 整数 | 30 | 摄像头原始帧率 |
|  | `source` | 整数/字符串 | 0 | 视频源：0=默认摄像头，1=外接摄像头，或文件路径 |
| **🤖 模型推理** | `model` | 字符串 | "yolo11n.pt" | YOLO模型权重文件 |
|  | `inffps` | 整数 | 20 | 推理帧率限制（性能优化） |
|  | `conf` | 浮点数 | 0.2 | 检测置信度阈值（0-1之间） |
|  | `usecuda` | 布尔值 | true | 启用GPU加速（需CUDA支持） |
|  | `classes` | 数组 | ["bicycle", "motorbike"] | 需要检测的类别列表 |
|  | `IOU` | 浮点数 | 0.1 | 交并比阈值，用于ROI区域判断 |
| **🗺️ ROI区域** | `roi_park` | 多边形数组 | - | 🅿️ 停车区域坐标（绿色显示） |
|  | `roi_pass` | 多边形数组 | - | 🚦 通行区域坐标（红色显示） |
| **⏰ 事件日志** | `block_secs` | 整数 | 8 | 事件触发持续时间阈值（秒） |
|  | `log_interval` | 整数 | 10 | 日志记录间隔时间（秒） |
|  | `preview` | 布尔值 | true | 启用实时预览窗口 |
|  | `lagtolerance` | 整数 | 12 | 延迟容忍帧数（性能监控） |
